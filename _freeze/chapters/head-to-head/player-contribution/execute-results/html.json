{
  "hash": "9374ec2525d7303254bb1a2be9140754",
  "result": {
    "engine": "knitr",
    "markdown": "# Player Contribution\n\nThe goal of this chapter is to build models to account for individual \ncontributions toward a team. \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"tidyverse\"); theme_set(theme_bw())\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4.9000     ✔ readr     2.1.5     \n✔ forcats   1.0.0          ✔ stringr   1.5.1     \n✔ ggplot2   3.5.1          ✔ tibble    3.2.1     \n✔ lubridate 1.9.3          ✔ tidyr     1.3.1     \n✔ purrr     1.0.2          \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(\"DT\")\n```\n:::\n\n\n\n\n\nLoad necessary code\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(\"../../R/construct_matrix.R\")\n```\n:::\n\n\n\n\n\n\n## Basic\n\n### Plus-minus\n\nThe plus-minus statistic is the most basic of statistics to estimate player \ncontribution. \nFor each player, you \n\n- sum the points scored by that players team while that player was playing and\n- subtract the sum of points scored by the opposing team while that player was playing.\n\nOne drawback of this plus-minus statistic is that it doesn't take into account\nwho is playing with or against you.\nThus if you are the best defender on a team and thus you are always subbed into\nand out of the game so that you are defending the best offensive player on the\nopposing team, your overall and defensive contribution may look poor. \n\n### Adjusted plus-minus\n\n[Adjusted plus-minus](https://en.wikipedia.org/wiki/Adjusted_Plus_Minus) \nstatistics, like those discussed below, \nkeep track of all the other players on the court and adjusts accordingly. \nRecall that multiple regression models \n``adjust for other explanatory variables''.\n\n## Models\n\nMany of the models we have introduced earlier can be used to estimate player \ncontribution. \nHere we will introduce how to use margin of victory, win-loss, and\noffense-defense models in the context of measuring player contribution. \n\n### Margin of Victory\n\nRecall that the margin of victory models use the difference between two teams\nscores, i.e. the margin of victory, to estimate the overall strength of a team. \nHere we will use the margin of victory to compute the contribution of players. \n\nTo do so, we need to organize the data by every combination of players that\nare on the court, calculate the margin while those players are on the court,\nand then build a model for those margins.\n\nLet $M_g$ be the margin of points scored while a set of players are on the court.\nAssume\n$$M_g = \\sum_{p \\in H[g]} \\theta_p - \\sum_{p\\in A[g]} \\theta_p+ \\epsilon_g$$\nwhere\n\n- $H[g]$ is the set of players on the home team during this time and\n- $A[g]$ is the set of players on the away team during this time. \n\nWe have the following parameters\n\n- $\\theta_p$ is the strength player $p$. \n\nIn this model, we only observe noisy estimates of the difference between \ncollections of strengths. \nThus we have an identifiability issue that will manifest itself in one of the\nestimates not being estimable. \nWe will treat this non-estimable strength as 0 and are allowed to add a constant\nto the $\\theta$s. \n\nThe parameters are transitive and thus the model is not capable of estimating\ncomplementary play among players on a team or match ups with opposing players.\n\nIf we assume $\\epsilon_g \\stackrel{ind}{\\sim} N(0,\\sigma^2)$,\nthen we have a regression model.\nTo estimate the parameters in this regression model, \nwe will need to construct a matrix that has a row for each combination of \nplayers and a column for each player.\nEach row contains a unique combination of home and away players with a 1 if \nthe home player is included in the combination and a -1 if the away player\nis included in the combination. \n\n### Win-(tie-)loss\n\nA win-loss or win-tie-loss model modifies the margin of victory model by only \nrecording whether, in this combination of players, the home team won, tied, or\nlost to the opposing players. \nThen a logistic (or ordinal logistic) regression model is fit using the \nmargin of victory matrix. \n\nFor high-scoring sports, using the margin provides much more information about\ncontribution of players. \nIn low-scoring sports, e.g. hockey or soccer, using these models may be useful.\n\n### Offense-defense\n\nRather than only using the margin of victory (or the win/tie/loss result)\nwe can also estimate offense and defense contribution of the players by \nutilizing both home and away scores.\n\nLet $S^H_g$ ($S_A_g$) be the points scored by the home team while a combination \nof players are on the court.\nAssume\n$$S^H_g = \\sum_{p \\in H[g]} \\theta_p - \\sum_{p\\in A[g]} \\delta_p+ \\epsilon^H_g$$\nand \n$$S^A_g = \\sum_{p \\in A[g]} \\theta_p - \\sum_{p\\in H[g]} \\delta_p+ \\epsilon^A_g$$\n\nWe have the following parameters\n\n- $\\theta_p$ is the offensive rating of player $p$ and\n- $\\delta_p$ is the defensive rating of player $p$.\n\nIn this model, we only observe noisy estimates of the difference between \noffense and defense ratings. \nThus we have an identifiability issue that will manifest itself in one of the\nestimates not being estimable. \nWe will treat this non-estimable rating as 0 and we are allowed to add a constant\nto the $\\theta$s and (the same constant) to the $\\delta$s. \n\nThe parameters are transitive and thus the model is not capable of estimating\ncomplementary play among players on a team or match ups with opposing players.\n\nIf we assume $\\epsilon^H_g,\\epsilon^A_g \\stackrel{ind}{\\sim} N(0,\\sigma^2)$,\nthen we have a regression model.\nTo estimate the parameters in this regression model, \nwe will need to construct two matrices that each have a row for each combination of \nplayers and a column for each player.\nIn the home matrix, each cell is a 1 if that home player is in the combination\nand a 0 otherwise. \nIn the home matrix, each cell is a 1 if that away player is in the combination\nand a 0 otherwise.\n\nThe margin of victory (and win-tie-loss) matrix is actually just the difference\nbetween the home and away matrix just described. \n\n\n\n## Examples\n\n### FRC MOSE 2025\n\nThe First Robotics Competition (FRC) is a high school robotics competition. \nEach match in an FRC competition pits two alliances (red and blue) each\ncomposed of 3 robots from different teams. \nThe robots within an alliance cooperate and compete against the robots in the\nother alliance to score points. \nThe alliance with more points at the end wins the match. \n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmp <- read_csv(\"../../data/frc_mose2025.csv\")  \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 66 Columns: 10\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (2): Match, Start Time\ndbl (8): Red 1, Red 2, Red 3, Blue 1, Blue 2, Blue 3, Red Final, Blue Final\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\n# Create factor for all teams\nteams <- tmp |>\n  select(`Red 1`:`Blue 3`) |>\n  pivot_longer(everything()) |>\n  pull(value) |>\n  unique() |>\n  sort()\n\nmose2025 <- tmp |>\n  mutate(\n    `Red 1`  = factor(`Red 1`,  levels = teams),\n    `Red 2`  = factor(`Red 2`,  levels = teams),\n    `Red 3`  = factor(`Red 3`,  levels = teams),\n    `Blue 1` = factor(`Blue 1`, levels = teams),\n    `Blue 2` = factor(`Blue 2`, levels = teams),\n    `Blue 3` = factor(`Blue 3`, levels = teams)\n  )\n\nmose2025 |> datatable(filter = \"top\", rownames = FALSE)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-77795d53b9cdf3828724\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-77795d53b9cdf3828724\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"factor\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"width: 100%; display: none;\\\">\\n      <select multiple=\\\"multiple\\\" style=\\\"width: 100%;\\\" data-options=\\\"[&quot;167&quot;,&quot;1710&quot;,&quot;1723&quot;,&quot;1736&quot;,&quot;1756&quot;,&quot;1763&quot;,&quot;1785&quot;,&quot;1806&quot;,&quot;1810&quot;,&quot;1939&quot;,&quot;1987&quot;,&quot;1997&quot;,&quot;2357&quot;,&quot;2718&quot;,&quot;2996&quot;,&quot;3184&quot;,&quot;3284&quot;,&quot;3928&quot;,&quot;4187&quot;,&quot;4213&quot;,&quot;4522&quot;,&quot;4646&quot;,&quot;4766&quot;,&quot;5126&quot;,&quot;5141&quot;,&quot;5576&quot;,&quot;5801&quot;,&quot;5809&quot;,&quot;5968&quot;,&quot;6419&quot;,&quot;7662&quot;,&quot;8112&quot;,&quot;8825&quot;,&quot;9031&quot;,&quot;9316&quot;,&quot;9570&quot;]\\\"><\\/select>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"factor\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"width: 100%; display: none;\\\">\\n      <select multiple=\\\"multiple\\\" style=\\\"width: 100%;\\\" data-options=\\\"[&quot;167&quot;,&quot;1710&quot;,&quot;1723&quot;,&quot;1736&quot;,&quot;1756&quot;,&quot;1763&quot;,&quot;1785&quot;,&quot;1806&quot;,&quot;1810&quot;,&quot;1939&quot;,&quot;1987&quot;,&quot;1997&quot;,&quot;2357&quot;,&quot;2718&quot;,&quot;2996&quot;,&quot;3184&quot;,&quot;3284&quot;,&quot;3928&quot;,&quot;4187&quot;,&quot;4213&quot;,&quot;4522&quot;,&quot;4646&quot;,&quot;4766&quot;,&quot;5126&quot;,&quot;5141&quot;,&quot;5576&quot;,&quot;5801&quot;,&quot;5809&quot;,&quot;5968&quot;,&quot;6419&quot;,&quot;7662&quot;,&quot;8112&quot;,&quot;8825&quot;,&quot;9031&quot;,&quot;9316&quot;,&quot;9570&quot;]\\\"><\\/select>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"factor\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"width: 100%; display: none;\\\">\\n      <select multiple=\\\"multiple\\\" style=\\\"width: 100%;\\\" data-options=\\\"[&quot;167&quot;,&quot;1710&quot;,&quot;1723&quot;,&quot;1736&quot;,&quot;1756&quot;,&quot;1763&quot;,&quot;1785&quot;,&quot;1806&quot;,&quot;1810&quot;,&quot;1939&quot;,&quot;1987&quot;,&quot;1997&quot;,&quot;2357&quot;,&quot;2718&quot;,&quot;2996&quot;,&quot;3184&quot;,&quot;3284&quot;,&quot;3928&quot;,&quot;4187&quot;,&quot;4213&quot;,&quot;4522&quot;,&quot;4646&quot;,&quot;4766&quot;,&quot;5126&quot;,&quot;5141&quot;,&quot;5576&quot;,&quot;5801&quot;,&quot;5809&quot;,&quot;5968&quot;,&quot;6419&quot;,&quot;7662&quot;,&quot;8112&quot;,&quot;8825&quot;,&quot;9031&quot;,&quot;9316&quot;,&quot;9570&quot;]\\\"><\\/select>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"factor\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"width: 100%; display: none;\\\">\\n      <select multiple=\\\"multiple\\\" style=\\\"width: 100%;\\\" data-options=\\\"[&quot;167&quot;,&quot;1710&quot;,&quot;1723&quot;,&quot;1736&quot;,&quot;1756&quot;,&quot;1763&quot;,&quot;1785&quot;,&quot;1806&quot;,&quot;1810&quot;,&quot;1939&quot;,&quot;1987&quot;,&quot;1997&quot;,&quot;2357&quot;,&quot;2718&quot;,&quot;2996&quot;,&quot;3184&quot;,&quot;3284&quot;,&quot;3928&quot;,&quot;4187&quot;,&quot;4213&quot;,&quot;4522&quot;,&quot;4646&quot;,&quot;4766&quot;,&quot;5126&quot;,&quot;5141&quot;,&quot;5576&quot;,&quot;5801&quot;,&quot;5809&quot;,&quot;5968&quot;,&quot;6419&quot;,&quot;7662&quot;,&quot;8112&quot;,&quot;8825&quot;,&quot;9031&quot;,&quot;9316&quot;,&quot;9570&quot;]\\\"><\\/select>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"factor\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"width: 100%; display: none;\\\">\\n      <select multiple=\\\"multiple\\\" style=\\\"width: 100%;\\\" data-options=\\\"[&quot;167&quot;,&quot;1710&quot;,&quot;1723&quot;,&quot;1736&quot;,&quot;1756&quot;,&quot;1763&quot;,&quot;1785&quot;,&quot;1806&quot;,&quot;1810&quot;,&quot;1939&quot;,&quot;1987&quot;,&quot;1997&quot;,&quot;2357&quot;,&quot;2718&quot;,&quot;2996&quot;,&quot;3184&quot;,&quot;3284&quot;,&quot;3928&quot;,&quot;4187&quot;,&quot;4213&quot;,&quot;4522&quot;,&quot;4646&quot;,&quot;4766&quot;,&quot;5126&quot;,&quot;5141&quot;,&quot;5576&quot;,&quot;5801&quot;,&quot;5809&quot;,&quot;5968&quot;,&quot;6419&quot;,&quot;7662&quot;,&quot;8112&quot;,&quot;8825&quot;,&quot;9031&quot;,&quot;9316&quot;,&quot;9570&quot;]\\\"><\\/select>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"factor\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"width: 100%; display: none;\\\">\\n      <select multiple=\\\"multiple\\\" style=\\\"width: 100%;\\\" data-options=\\\"[&quot;167&quot;,&quot;1710&quot;,&quot;1723&quot;,&quot;1736&quot;,&quot;1756&quot;,&quot;1763&quot;,&quot;1785&quot;,&quot;1806&quot;,&quot;1810&quot;,&quot;1939&quot;,&quot;1987&quot;,&quot;1997&quot;,&quot;2357&quot;,&quot;2718&quot;,&quot;2996&quot;,&quot;3184&quot;,&quot;3284&quot;,&quot;3928&quot;,&quot;4187&quot;,&quot;4213&quot;,&quot;4522&quot;,&quot;4646&quot;,&quot;4766&quot;,&quot;5126&quot;,&quot;5141&quot;,&quot;5576&quot;,&quot;5801&quot;,&quot;5809&quot;,&quot;5968&quot;,&quot;6419&quot;,&quot;7662&quot;,&quot;8112&quot;,&quot;8825&quot;,&quot;9031&quot;,&quot;9316&quot;,&quot;9570&quot;]\\\"><\\/select>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"19\\\" data-max=\\\"154\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"14\\\" data-max=\\\"170\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"data\":[[\"Qualification 1  \",\"Qualification 2  \",\"Qualification 3  \",\"Qualification 4  \",\"Qualification 5  \",\"Qualification 6  \",\"Qualification 7  \",\"Qualification 8  \",\"Qualification 9  \",\"Qualification 10  \",\"Qualification 11  \",\"Qualification 12  \",\"Qualification 13  \",\"Qualification 14  \",\"Qualification 15  \",\"Qualification 16  \",\"Qualification 17  \",\"Qualification 18  \",\"Qualification 19  \",\"Qualification 20  \",\"Qualification 21  \",\"Qualification 22  \",\"Qualification 23  \",\"Qualification 24  \",\"Qualification 25  \",\"Qualification 26  \",\"Qualification 27  \",\"Qualification 28  \",\"Qualification 29  \",\"Qualification 30  \",\"Qualification 31  \",\"Qualification 32  \",\"Qualification 33  \",\"Qualification 34  \",\"Qualification 35  \",\"Qualification 36  \",\"Qualification 37  \",\"Qualification 38  \",\"Qualification 39  \",\"Qualification 40  \",\"Qualification 41  \",\"Qualification 42  \",\"Qualification 43  \",\"Qualification 44  \",\"Qualification 45  \",\"Qualification 46  \",\"Qualification 47  \",\"Qualification 48  \",\"Qualification 49  \",\"Qualification 50  \",\"Qualification 51  \",\"Qualification 52  \",\"Qualification 53  \",\"Qualification 54  \",\"Qualification 55  \",\"Qualification 56  \",\"Qualification 57  \",\"Qualification 58  \",\"Qualification 59  \",\"Qualification 60  \",\"Qualification 61  \",\"Qualification 62  \",\"Qualification 63  \",\"Qualification 64  \",\"Qualification 65  \",\"Qualification 66  \"],[\"Fri 3/7 - 8:59 AM\",\"Fri 3/7 - 9:14 AM\",\"Fri 3/7 - 9:23 AM\",\"Fri 3/7 - 9:37 AM\",\"Fri 3/7 - 9:47 AM\",\"Fri 3/7 - 9:56 AM\",\"Fri 3/7 - 10:07 AM\",\"Fri 3/7 - 10:15 AM\",\"Fri 3/7 - 10:24 AM\",\"Fri 3/7 - 10:33 AM\",\"Fri 3/7 - 10:41 AM\",\"Fri 3/7 - 10:48 AM\",\"Fri 3/7 - 10:58 AM\",\"Fri 3/7 - 11:07 AM\",\"Fri 3/7 - 11:26 AM\",\"Fri 3/7 - 11:34 AM\",\"Fri 3/7 - 11:42 AM\",\"Fri 3/7 - 11:53 AM\",\"Fri 3/7 - 12:02 PM\",\"Fri 3/7 - 1:04 PM\",\"Fri 3/7 - 1:14 PM\",\"Fri 3/7 - 1:22 PM\",\"Fri 3/7 - 1:33 PM\",\"Fri 3/7 - 1:48 PM\",\"Fri 3/7 - 2:00 PM\",\"Fri 3/7 - 2:08 PM\",\"Fri 3/7 - 2:18 PM\",\"Fri 3/7 - 2:29 PM\",\"Fri 3/7 - 2:37 PM\",\"Fri 3/7 - 2:45 PM\",\"Fri 3/7 - 2:53 PM\",\"Fri 3/7 - 3:12 PM\",\"Fri 3/7 - 3:21 PM\",\"Fri 3/7 - 3:29 PM\",\"Fri 3/7 - 3:38 PM\",\"Fri 3/7 - 3:46 PM\",\"Fri 3/7 - 3:55 PM\",\"Fri 3/7 - 4:05 PM\",\"Fri 3/7 - 4:15 PM\",\"Fri 3/7 - 4:26 PM\",\"Fri 3/7 - 4:36 PM\",\"Fri 3/7 - 4:44 PM\",\"Fri 3/7 - 4:52 PM\",\"Fri 3/7 - 5:06 PM\",\"Fri 3/7 - 5:15 PM\",\"Fri 3/7 - 5:24 PM\",\"Fri 3/7 - 5:32 PM\",\"Fri 3/7 - 5:41 PM\",\"Sat 3/8 - 8:56 AM\",\"Sat 3/8 - 9:06 AM\",\"Sat 3/8 - 9:21 AM\",\"Sat 3/8 - 9:29 AM\",\"Sat 3/8 - 9:38 AM\",\"Sat 3/8 - 9:45 AM\",\"Sat 3/8 - 9:53 AM\",\"Sat 3/8 - 10:01 AM\",\"Sat 3/8 - 10:09 AM\",\"Sat 3/8 - 10:26 AM\",\"Sat 3/8 - 10:37 AM\",\"Sat 3/8 - 10:44 AM\",\"Sat 3/8 - 10:51 AM\",\"Sat 3/8 - 10:59 AM\",\"Sat 3/8 - 11:13 AM\",\"Sat 3/8 - 11:23 AM\",\"Sat 3/8 - 11:32 AM\",\"Sat 3/8 - 11:40 AM\"],[\"4213\",\"1756\",null,\"1736\",\"5801\",\"4522\",\"4646\",\"9570\",\"5141\",\"9316\",\"4187\",\"2718\",\"1987\",\"9316\",\"5968\",\"4522\",\"167\",\"5576\",\"8112\",\"1736\",\"1997\",\"1723\",\"1806\",\"3284\",\"2996\",\"3928\",\"3184\",\"1710\",\"1810\",\"5809\",\"2357\",\"4646\",\"1810\",\"9031\",\"5809\",\"1723\",\"6419\",\"5576\",\"5809\",\"5126\",\"3928\",\"5141\",\"5801\",\"5126\",\"8825\",\"1710\",\"3184\",\"9316\",\"6419\",\"5801\",\"9570\",\"1785\",\"167\",\"4213\",\"1763\",\"5126\",\"9570\",\"4213\",\"2357\",\"2996\",\"1763\",\"1806\",\"1756\",\"167\",\"5141\",\"1997\"],[\"1810\",\"5968\",\"3184\",\"3284\",\"5126\",\"1710\",\"3928\",\"3284\",\"3184\",\"5126\",\"4522\",\"5576\",\"4213\",\"5801\",\"4766\",\"1810\",\"1997\",\"6419\",\"9570\",\"2996\",\"2357\",\"9031\",\"4187\",\"1785\",\"7662\",\"4766\",\"5968\",\"2718\",\"9031\",\"8825\",\"4522\",\"1806\",\"1710\",\"5801\",\"167\",\"3284\",\"4646\",\"1987\",\"9031\",\"9570\",\"7662\",\"1723\",\"2718\",\"1810\",\"1736\",\"1756\",\"2996\",\"5141\",\"4187\",\"1763\",\"1997\",\"1756\",\"5576\",\"1939\",\"1987\",\"3928\",\"9316\",\"1736\",\"1710\",\"167\",\"1785\",\"9316\",\"7662\",\"1723\",\"8112\",\"6419\"],[\"5576\",\"4646\",\"9031\",\"2718\",\"1723\",\"2996\",null,\"6419\",\"4213\",\"1939\",\"1723\",\"2357\",\"3284\",\"8112\",\"1785\",\"5809\",\"2718\",\"1806\",\"5968\",\"1763\",\"7662\",\"4766\",\"1939\",\"167\",\"1987\",\"5141\",\"1763\",\"1806\",\"1939\",\"4187\",\"3184\",\"4766\",\"1987\",\"1736\",\"5126\",\"1756\",\"1810\",\"5801\",\"2718\",\"8825\",\"3184\",\"1806\",\"4522\",\"3284\",\"2357\",\"1997\",\"4766\",\"5968\",\"1736\",\"3928\",\"1810\",\"5141\",\"5968\",\"7662\",\"1997\",\"1785\",\"9031\",\"5809\",\"1939\",\"8112\",\"4646\",\"4213\",\"4187\",\"1710\",\"8825\",\"4522\"],[\"3928\",\"1939\",\"1997\",\"4766\",\"1806\",\"4187\",\"9031\",\"7662\",\"5801\",\"4766\",\"5809\",\"2996\",\"9031\",\"1939\",\"1710\",\"1756\",\"4187\",\"3184\",\"4213\",\"5141\",\"4522\",\"1810\",\"6419\",\"4646\",\"8112\",\"1997\",\"1756\",\"3284\",\"167\",\"1785\",\"5968\",\"7662\",\"6419\",\"2996\",\"9316\",\"1785\",\"1763\",\"2357\",\"1736\",\"3284\",\"1785\",\"1939\",\"1763\",\"4187\",\"3928\",\"1939\",\"1987\",\"7662\",\"9031\",\"3284\",\"4646\",\"2718\",\"8825\",\"1723\",\"3184\",\"2718\",\"4766\",\"1806\",\"8825\",\"5968\",\"5576\",\"1987\",\"4766\",\"1736\",\"1810\",\"5968\"],[\"167\",\"8825\",\"5809\",\"9570\",\"1785\",\"1763\",\"1987\",\"1736\",\"5968\",\"1763\",\"1785\",\"1806\",\"5141\",\"1736\",\"1763\",\"2996\",\"2357\",\"8825\",\"1710\",\"5126\",\"1756\",\"2718\",\"3184\",\"5809\",\"4522\",\"4213\",\"6419\",\"9316\",\"9570\",\"5576\",\"3928\",\"8112\",\"1939\",\"5141\",\"8825\",\"4187\",\"4213\",\"4766\",\"5968\",\"1997\",\"9316\",\"167\",\"6419\",\"4646\",\"5809\",\"8112\",\"1806\",\"1723\",\"2357\",\"8112\",\"1987\",\"4766\",\"4522\",\"2996\",\"5801\",\"4646\",\"5576\",\"1810\",\"7662\",\"1723\",\"3928\",\"2718\",\"5801\",\"5126\",\"2357\",\"1939\"],[\"6419\",\"1987\",\"5141\",\"7662\",\"2357\",\"9316\",\"1756\",\"167\",\"8825\",\"1810\",\"1710\",\"1997\",\"7662\",\"4646\",\"9570\",\"5126\",\"3928\",\"1723\",\"5801\",\"1987\",\"3928\",\"8825\",\"9316\",\"5576\",\"5126\",\"1723\",\"2357\",\"4646\",\"5801\",\"1736\",\"4213\",\"1763\",\"2718\",\"5576\",\"1997\",\"9570\",\"4522\",\"8112\",\"1710\",\"4187\",\"2996\",\"1756\",\"9031\",\"4213\",\"9570\",\"1785\",\"167\",\"5576\",\"5126\",\"1710\",\"3184\",\"9316\",\"1806\",\"5809\",\"4187\",\"5141\",\"4522\",\"1756\",\"3284\",\"6419\",\"9031\",\"9570\",\"5809\",\"3184\",\"2996\",\"3284\"],[49,147,19,97,86,154,102,22,81,63,86,52,107,74,58,109,117,24,31,113,79,50,30,95,114,107,56,87,46,44,89,82,99,104,94,105,83,82,65,69,79,32,127,111,95,139,104,82,69,88,44,137,84,123,47,52,32,107,112,107,85,22,84,121,23,126],[85,115,38,39,55,27,129,79,89,67,96,62,20,100,64,141,102,51,117,73,170,104,52,107,94,60,101,74,134,60,73,19,44,53,44,53,106,93,107,56,89,144,14,114,97,28,129,35,67,96,97,89,106,120,99,101,95,87,80,58,32,105,109,98,120,91]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>Match<\\/th>\\n      <th>Start Time<\\/th>\\n      <th>Red 1<\\/th>\\n      <th>Red 2<\\/th>\\n      <th>Red 3<\\/th>\\n      <th>Blue 1<\\/th>\\n      <th>Blue 2<\\/th>\\n      <th>Blue 3<\\/th>\\n      <th>Red Final<\\/th>\\n      <th>Blue Final<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[8,9]},{\"name\":\"Match\",\"targets\":0},{\"name\":\"Start Time\",\"targets\":1},{\"name\":\"Red 1\",\"targets\":2},{\"name\":\"Red 2\",\"targets\":3},{\"name\":\"Red 3\",\"targets\":4},{\"name\":\"Blue 1\",\"targets\":5},{\"name\":\"Blue 2\",\"targets\":6},{\"name\":\"Blue 3\",\"targets\":7},{\"name\":\"Red Final\",\"targets\":8},{\"name\":\"Blue Final\",\"targets\":9}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"orderCellsTop\":true}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\n\nConstruct the model matrices.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Construct model matrices\nX_red <- construct_matrix(mose2025, \"Red 1\", 36) +\n  construct_matrix(mose2025, \"Red 2\", 36) +\n  construct_matrix(mose2025, \"Red 3\", 36) \n\nX_blue <- construct_matrix(mose2025, \"Blue 1\", 36) +\n  construct_matrix(mose2025, \"Blue 2\", 36) +\n  construct_matrix(mose2025, \"Blue 3\", 36) \n\n# Team 8112 did not arrive on time and thus is missing in its first two matches\ntable(rowSums(X_red))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n 2  3 \n 2 64 \n```\n\n\n:::\n\n```{.r .cell-code}\ncolSums(X_red) + colSums(X_blue)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] 11 11 11 11 11 11 11 11 11 11 11 11 11 11 11 11 11 11 11 11 11 11 11 11 11\n[26] 11 11 11 11 11 11  9 11 11 11 11\n```\n\n\n:::\n:::\n\n\n\n\n\n#### Margin-of-victory\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Margin of victory\nmargin <- mose2025$`Red Final` - mose2025$`Blue Final`\nX      <- X_red - X_blue\n\n# Fit model\nm <- lm(margin ~ 0 + X)\nsummary(m)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = margin ~ 0 + X)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-32.072 -12.012  -0.991   9.348  28.648 \n\nCoefficients:\n     Estimate Std. Error t value Pr(>|t|)   \nX1   32.78327   22.03586   1.488  0.14726   \nX2   35.32327   22.13049   1.596  0.12094   \nX3  -13.11301   21.10238  -0.621  0.53903   \nX4   34.70001   19.76075   1.756  0.08929 . \nX5   53.45324   18.23908   2.931  0.00641 **\nX6   -7.14437   21.22680  -0.337  0.73878   \nX7   -2.67667   21.56301  -0.124  0.90204   \nX8   -8.61222   21.24984  -0.405  0.68814   \nX9   12.79973   21.38853   0.598  0.55404   \nX10   0.40000   20.33682   0.020  0.98444   \nX11  33.17262   19.32958   1.716  0.09644 . \nX12  -2.92442   20.55895  -0.142  0.88784   \nX13  21.59756   20.91798   1.032  0.31010   \nX14  24.78412   21.66550   1.144  0.26169   \nX15  34.92238   21.42684   1.630  0.11359   \nX16   8.41969   22.25842   0.378  0.70789   \nX17  13.16429   21.66096   0.608  0.54793   \nX18  16.34456   23.47253   0.696  0.49158   \nX19  -4.75531   20.89914  -0.228  0.82155   \nX20  22.66517   21.43216   1.058  0.29871   \nX21  45.81500   21.40169   2.141  0.04054 * \nX22  31.37322   24.05015   1.304  0.20199   \nX23  15.74974   19.99957   0.788  0.43716   \nX24   7.17833   21.62800   0.332  0.74227   \nX25   3.44937   19.26132   0.179  0.85908   \nX26 -23.00223   21.66266  -1.062  0.29678   \nX27  39.36746   20.85684   1.888  0.06880 . \nX28  14.98666   18.28304   0.820  0.41885   \nX29   8.88407   20.87734   0.426  0.67348   \nX30   0.31866   21.28422   0.015  0.98815   \nX31  -0.01757   20.92329  -0.001  0.99934   \nX32  -7.57706   21.74861  -0.348  0.72998   \nX33   0.13821   21.78107   0.006  0.99498   \nX34 -13.09630   22.12502  -0.592  0.55834   \nX35  -5.65949   20.83653  -0.272  0.78778   \nX36   9.70302   20.85504   0.465  0.64511   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 21.05 on 30 degrees of freedom\nMultiple R-squared:  0.9216,\tAdjusted R-squared:  0.8275 \nF-statistic: 9.793 on 36 and 30 DF,  p-value: 4.045e-09\n```\n\n\n:::\n:::\n\n\n\n\n\nExtract parameters\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmose2025_margin <- data.frame(\n  team   = teams,\n  rating = coef(m)\n) |>\n  mutate(\n    rating = ifelse(is.na(rating), 0, rating),\n    rating = rating - mean(rating),\n    team   = factor(team, levels = team[order(rating)])\n  ) |>\n  arrange(desc(team))\n\nmose2025_margin |> \n  datatable(filter = \"top\", \n            rownames = FALSE) |>\n  formatRound(columns = \"rating\", digits = 1)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-075fd9f65af6d0ca35f9\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-075fd9f65af6d0ca35f9\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"factor\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"width: 100%; display: none;\\\">\\n      <select multiple=\\\"multiple\\\" style=\\\"width: 100%;\\\" data-options=\\\"[&quot;5576&quot;,&quot;1723&quot;,&quot;9031&quot;,&quot;1806&quot;,&quot;8112&quot;,&quot;1763&quot;,&quot;9316&quot;,&quot;4187&quot;,&quot;1997&quot;,&quot;1785&quot;,&quot;7662&quot;,&quot;8825&quot;,&quot;6419&quot;,&quot;1939&quot;,&quot;5141&quot;,&quot;5126&quot;,&quot;3184&quot;,&quot;5968&quot;,&quot;9570&quot;,&quot;1810&quot;,&quot;3284&quot;,&quot;5809&quot;,&quot;4766&quot;,&quot;3928&quot;,&quot;2357&quot;,&quot;4213&quot;,&quot;2718&quot;,&quot;4646&quot;,&quot;167&quot;,&quot;1987&quot;,&quot;1736&quot;,&quot;2996&quot;,&quot;1710&quot;,&quot;5801&quot;,&quot;4522&quot;,&quot;1756&quot;]\\\"><\\/select>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"-35.0276442194729\\\" data-max=\\\"41.427823671415\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"data\":[[\"1756\",\"4522\",\"5801\",\"1710\",\"2996\",\"1736\",\"1987\",\"167\",\"4646\",\"2718\",\"4213\",\"2357\",\"3928\",\"4766\",\"5809\",\"3284\",\"1810\",\"9570\",\"5968\",\"3184\",\"5126\",\"5141\",\"1939\",\"6419\",\"8825\",\"7662\",\"1785\",\"1997\",\"4187\",\"9316\",\"1763\",\"8112\",\"1806\",\"9031\",\"1723\",\"5576\"],[41.42782367141504,33.78958220557492,27.34204448635341,23.29785409634571,22.89696171743527,22.67459521602217,21.14720799146779,20.75785625945241,19.3478070176265,12.75870346805223,10.63975005806831,9.572147702814988,4.319143469411472,3.724321800672847,2.961242706988596,1.138875968158327,0.7743146207813609,-2.322400618105855,-3.141351165127228,-3.60572933336964,-4.847088364919528,-8.576046416969175,-11.62541417692071,-11.70675852501845,-11.88720387852399,-12.0429857364193,-14.7020831874486,-14.94984033625065,-16.78072932598518,-17.68490690266741,-19.16978492331622,-19.60248138872473,-20.6376359219573,-25.12171776379761,-25.13843027164686,-35.02764421947293]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>team<\\/th>\\n      <th>rating<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"targets\":1,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"className\":\"dt-right\",\"targets\":1},{\"name\":\"team\",\"targets\":0},{\"name\":\"rating\",\"targets\":1}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"orderCellsTop\":true}},\"evals\":[\"options.columnDefs.0.render\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\n\nLet's plot the teams\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mose2025_margin,\n       aes(\n         x = rating,\n         y = team\n       )) +\n  geom_bar(stat=\"identity\") +\n  labs(\n    x = \"Rating\",\n    y = \"Team\",\n    title = \"FRC MOSE 2025 - Qualification\"\n  )\n```\n\n::: {.cell-output-display}\n![](player-contribution_files/figure-html/mose2025-margin-plot-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\n#### Offense-defense rating\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Offense-defense analysis\nY <- c(mose2025$`Red Final`, mose2025$`Blue Final`)\n\nX <- rbind(\n  cbind(X_red, -X_blue),\n  cbind(X_blue, -X_red)\n)\n\n# Fit model\nm <- lm(Y ~ 0 + X)\nsummary(m)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = Y ~ 0 + X)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-36.207  -7.766  -0.071   7.573  38.986 \n\nCoefficients:\n    Estimate Std. Error t value Pr(>|t|)    \nX1   43.8951    13.3222   3.295 0.001656 ** \nX2   34.9304    13.5500   2.578 0.012414 *  \nX3   10.8295    12.8455   0.843 0.402546    \nX4   35.9272    12.2269   2.938 0.004677 ** \nX5   62.3330    11.3390   5.497 8.34e-07 ***\nX6   -1.4760    13.0057  -0.113 0.910021    \nX7    5.4824    13.2685   0.413 0.680939    \nX8   -7.0574    13.0420  -0.541 0.590422    \nX9   15.3925    13.2219   1.164 0.248964    \nX10  19.5784    12.5320   1.562 0.123483    \nX11  39.9903    11.9146   3.356 0.001375 ** \nX12   6.4936    12.5972   0.515 0.608110    \nX13  29.0438    12.7899   2.271 0.026760 *  \nX14  25.7603    13.3206   1.934 0.057850 .  \nX15  49.6175    13.1305   3.779 0.000365 ***\nX16  10.3956    13.5956   0.765 0.447488    \nX17  27.6079    13.2784   2.079 0.041886 *  \nX18  29.0033    14.2419   2.036 0.046123 *  \nX19   6.7156    12.7538   0.527 0.600445    \nX20  30.6782    13.1763   2.328 0.023285 *  \nX21  52.6416    13.0133   4.045 0.000152 ***\nX22  43.4943    14.5655   2.986 0.004086 ** \nX23  29.7568    12.2956   2.420 0.018561 *  \nX24  15.8235    13.1610   1.202 0.233972    \nX25   3.2810    11.9871   0.274 0.785246    \nX26 -11.6460    13.2949  -0.876 0.384539    \nX27  43.3526    12.7749   3.394 0.001227 ** \nX28  19.7888    11.4961   1.721 0.090342 .  \nX29  21.3382    12.8701   1.658 0.102544    \nX30  -1.9155    13.1388  -0.146 0.884578    \nX31   4.2237    12.7994   0.330 0.742553    \nX32  -6.1444    13.5890  -0.452 0.652785    \nX33  14.3661    13.1934   1.089 0.280559    \nX34  -2.0014    13.3977  -0.149 0.881753    \nX35   6.2746    12.7327   0.493 0.623956    \nX36   1.7197    12.7955   0.134 0.893538    \nX37 -11.1118    13.3222  -0.834 0.407541    \nX38   0.3929    13.5500   0.029 0.976964    \nX39 -23.9425    12.8455  -1.864 0.067233 .  \nX40  -1.2272    12.2269  -0.100 0.920387    \nX41  -8.8797    11.3390  -0.783 0.436642    \nX42  -5.6684    13.0057  -0.436 0.664519    \nX43  -8.1591    13.2685  -0.615 0.540931    \nX44  -1.5548    13.0420  -0.119 0.905503    \nX45  -2.5927    13.2219  -0.196 0.845199    \nX46 -19.1784    12.5320  -1.530 0.131184    \nX47  -6.8177    11.9146  -0.572 0.569315    \nX48  -9.4181    12.5972  -0.748 0.457603    \nX49  -7.4462    12.7899  -0.582 0.562617    \nX50  -0.9761    13.3206  -0.073 0.941827    \nX51 -14.6952    13.1305  -1.119 0.267533    \nX52  -1.9759    13.5956  -0.145 0.884934    \nX53 -14.4436    13.2784  -1.088 0.281057    \nX54 -12.6587    14.2419  -0.889 0.377640    \nX55 -11.4709    12.7538  -0.899 0.372031    \nX56  -8.0130    13.1763  -0.608 0.545389    \nX57  -6.8266    13.0133  -0.525 0.601801    \nX58 -12.1211    14.5655  -0.832 0.408608    \nX59 -14.0071    12.2956  -1.139 0.259152    \nX60  -8.6452    13.1610  -0.657 0.513773    \nX61   0.1684    11.9871   0.014 0.988841    \nX62 -11.3563    13.2949  -0.854 0.396403    \nX63  -3.9851    12.7749  -0.312 0.756161    \nX64  -4.8021    11.4961  -0.418 0.677646    \nX65 -12.4542    12.8701  -0.968 0.337089    \nX66   2.2341    13.1388   0.170 0.865551    \nX67  -4.2413    12.7994  -0.331 0.741521    \nX68  -1.4327    13.5890  -0.105 0.916386    \nX69 -14.2278    13.1934  -1.078 0.285168    \nX70 -11.0949    13.3977  -0.828 0.410885    \nX71 -11.9341    12.7327  -0.937 0.352372    \nX72   7.9833    12.7955   0.624 0.535045    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 16.99 on 60 degrees of freedom\nMultiple R-squared:  0.9834,\tAdjusted R-squared:  0.9634 \nF-statistic: 49.23 on 72 and 60 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n\n\n\nExtract parameters\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmose2025_offense_defense <- data.frame(\n  team   = rep(teams, times = 2),\n  type   = rep(c(\"offense\",\"defense\"), each = length(teams)),\n  rating = coef(m)\n) |>\n  mutate(\n    rating = ifelse(is.na(rating), 0, rating),\n    rating = rating - mean(rating)\n  ) |>\n  pivot_wider(\n    names_from = \"type\", \n    values_from = \"rating\") |>\n  mutate(\n    strength = offense + defense,\n    team    = factor(team, team[order(strength)])\n  ) |>\n  arrange(desc(team))\n\nmose2025_offense_defense |> \n  datatable(filter = \"top\", \n            rownames = FALSE) |>\n  formatRound(columns = c(\"offense\",\"defense\",\"strength\"), digits = 1)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-18e0e297bb4708410d3b\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-18e0e297bb4708410d3b\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"factor\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"width: 100%; display: none;\\\">\\n      <select multiple=\\\"multiple\\\" style=\\\"width: 100%;\\\" data-options=\\\"[&quot;5576&quot;,&quot;1723&quot;,&quot;9031&quot;,&quot;1806&quot;,&quot;8112&quot;,&quot;1763&quot;,&quot;9316&quot;,&quot;4187&quot;,&quot;1997&quot;,&quot;1785&quot;,&quot;7662&quot;,&quot;8825&quot;,&quot;6419&quot;,&quot;1939&quot;,&quot;5141&quot;,&quot;5126&quot;,&quot;3184&quot;,&quot;5968&quot;,&quot;9570&quot;,&quot;1810&quot;,&quot;3284&quot;,&quot;5809&quot;,&quot;4766&quot;,&quot;3928&quot;,&quot;2357&quot;,&quot;4213&quot;,&quot;2718&quot;,&quot;4646&quot;,&quot;167&quot;,&quot;1987&quot;,&quot;1736&quot;,&quot;2996&quot;,&quot;1710&quot;,&quot;5801&quot;,&quot;4522&quot;,&quot;1756&quot;]\\\"><\\/select>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"-17.6586831861928\\\" data-max=\\\"56.3202435473907\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"-29.9552021593662\\\" data-max=\\\"1.97062781255944\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"-35.0276442194729\\\" data-max=\\\"41.4278236714151\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"data\":[[\"1756\",\"4522\",\"5801\",\"1710\",\"2996\",\"1736\",\"1987\",\"167\",\"4646\",\"2718\",\"4213\",\"2357\",\"3928\",\"4766\",\"5809\",\"3284\",\"1810\",\"9570\",\"5968\",\"3184\",\"5126\",\"5141\",\"1939\",\"6419\",\"8825\",\"7662\",\"1785\",\"1997\",\"4187\",\"9316\",\"1763\",\"8112\",\"1806\",\"9031\",\"1723\",\"5576\"],[56.32024354739075,46.62892905796976,37.33987742288901,28.9176747995441,43.60482057227222,29.91449910458437,33.97763052406285,37.88240759409978,37.48163988174704,19.74754402736116,24.6655066909775,23.03106087970152,22.99057362434738,23.74409082549446,13.77607613429507,21.59515621064853,9.379747165580117,-4.293028430665286,15.32551428274265,4.382878038120467,9.810784849152309,-2.731695623605342,13.56570026032024,-7.928166912795389,8.353353703664693,-1.788960253787936,-0.5302783938080333,0.4809198171834064,0.7028571356761733,0.2619264018509622,-7.488715716949724,-12.15708003555301,-13.07011759392466,-8.014095938306401,4.816771887719323,-17.65868318619282],[-14.8924198759756,-12.8393468523949,-9.997832936535561,-5.619820703198414,-20.70785885483701,-7.239903888562209,-12.83042253259507,-17.12455133464742,-18.13383286412055,-6.988840559308942,-14.02575663290923,-13.45891317688644,-18.67143015493593,-20.01976902482161,-10.81483342730642,-20.45628024249018,-8.605432544798811,1.970627812559441,-18.46686544786991,-7.988607371490104,-14.65787321407185,-5.844350793363857,-25.19111443724094,-3.778591612223096,-20.24055758218871,-10.25402548263135,-14.17180479364054,-15.43076015343403,-17.48358646166137,-17.94683330451834,-11.68106920636648,-7.445401353171703,-7.567518328032607,-17.10762182549126,-29.9552021593662,-17.36896103328008],[41.42782367141515,33.78958220557487,27.34204448635345,23.29785409634569,22.89696171743521,22.67459521602216,21.14720799146778,20.75785625945236,19.34780701762649,12.75870346805222,10.63975005806827,9.572147702815078,4.319143469411451,3.724321800672854,2.961242706988649,1.138875968158345,0.7743146207813059,-2.322400618105845,-3.141351165127253,-3.605729333369638,-4.847088364919539,-8.576046416969199,-11.6254141769207,-11.70675852501848,-11.88720387852402,-12.04298573641929,-14.70208318744858,-14.94984033625062,-16.7807293259852,-17.68490690266737,-19.16978492331621,-19.60248138872471,-20.63763592195726,-25.12171776379766,-25.13843027164688,-35.0276442194729]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>team<\\/th>\\n      <th>offense<\\/th>\\n      <th>defense<\\/th>\\n      <th>strength<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"targets\":1,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":2,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":3,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"className\":\"dt-right\",\"targets\":[1,2,3]},{\"name\":\"team\",\"targets\":0},{\"name\":\"offense\",\"targets\":1},{\"name\":\"defense\",\"targets\":2},{\"name\":\"strength\",\"targets\":3}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"orderCellsTop\":true}},\"evals\":[\"options.columnDefs.0.render\",\"options.columnDefs.1.render\",\"options.columnDefs.2.render\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\n\nLet's plot the teams\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mose2025_offense_defense |>\n         pivot_longer(\n           offense:strength,\n           names_to = \"type\",\n           values_to = \"rating\"),\n       aes(\n         x = rating,\n         y = team\n       )) +\n  geom_point(aes(color = type)) +\n  # geom_bar(stat=\"identity\") +\n  # facet_wrap(~type) +\n  labs(\n    x = \"Rating\",\n    y = \"Team\",\n    title = \"FRC MOSE 2025 - Qualification\"\n  )\n```\n\n::: {.cell-output-display}\n![](player-contribution_files/figure-html/mose2025-offense-defense-plot-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n## Player Contribution Systems\n\n- [Winval](https://www.nbastuffer.com/analytics101/winval/) \n- [WAR](https://www.mlb.com/glossary/advanced-stats/wins-above-replacement)\n\n## Summary\n\nThese models could be extended or modified in many different directions. \n\n### Time\n\nIn the FRC example, the time is fixed by the match duration. \nIn other sports, the time may be variable as we are looking at how long a \ncombination of players is on the field. \nIncorporating the duration on the field would have two impacts:\n1) the expected margin (or scores) would be expected to increase and\n2) the variability would increase. \n\nIf $T_g$ is the time associated with margin $M_g$, \nthen we can modify our margin of victory model accordingly\n\n$$M_g = T_g\\left(\\sum_{p \\in H[g]} \\theta_p - \\sum_{p\\in A[g]} \\theta_p \\right)+ \\epsilon_g,\n\\quad \\epsilon_g \\stackrel{ind}{\\sim} N(0,T_g \\sigma^2)$$\n\nNow, we need each row in our model matrix to be multiplied by the corresponding\n$T_g$, e.g. multiply row 1 by $T_1$. \nThen we can use weighted regression to incorporate $T_g$ into the variance. \n\nOur offense-defense contribution would be modified by \n\n$$S^H_g = T_g\\left(\\sum_{p \\in H[g]} \\theta_p - \\sum_{p\\in A[g]} \\delta_p \\right)+ \\epsilon^H_g,\n\\quad \\epsilon^H_g \\stackrel{ind}{\\sim} N(0,T_g\\sigma^2)$$\nand \n$$S^A_g = T_g\\left(\\sum_{p \\in A[g]} \\theta_p - \\sum_{p\\in H[g]} \\delta_p \\right)+ \\epsilon^A_g,\n\\quad \\epsilon^A_g \\stackrel{ind}{\\sim} N(0,T_g\\sigma^2).$$\nTo incorporate these changes, we would multiply each row in our matrices by the\ncorresponding $T_g$ and use weighted regression for the $T_g$ in the variance. \n\n### Home advantage\n\nThe presentation here as ignored the home advantage.\nIf we want to incorporate the home advantage (and we also have time) \nthen we could add the home advantage into our model.\nIn the margin of victory model\n$$M_g = T_g\\left(\\eta + \\sum_{p \\in H[g]} \\theta_p - \\sum_{p\\in A[g]} \\theta_p \\right)+ \\epsilon_g,\n\\quad \\epsilon_g \\stackrel{ind}{\\sim} N(0,T_g \\sigma^2).$$\nThe interpretation of $\\eta$ would be *per unit time* using whatever time \nunits were used for $T_g$. \nTo get the entire home advantage, we would calculate $\\eta \\sum_{g=1}^G T_g$. \nA similar change can be made in the offense-defense model for $S^H_g$. \n",
    "supporting": [
      "player-contribution_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/datatables-binding-0.33/datatables.js\"></script>\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<link href=\"../../site_libs/nouislider-7.0.10/jquery.nouislider.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/nouislider-7.0.10/jquery.nouislider.min.js\"></script>\n<link href=\"../../site_libs/selectize-0.12.0/selectize.bootstrap3.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/selectize-0.12.0/selectize.min.js\"></script>\n<link href=\"../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}