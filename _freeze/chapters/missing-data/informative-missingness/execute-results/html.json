{
  "hash": "1b4ff7e8a4abf5a9cd04b3feddca624b",
  "result": {
    "engine": "knitr",
    "markdown": "# Informative Missingness\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"tidyverse\"); theme_set(theme_bw())\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'purrr' was built under R version 4.4.1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4.9000     ✔ readr     2.1.5     \n✔ forcats   1.0.0          ✔ stringr   1.5.1     \n✔ ggplot2   3.5.1          ✔ tibble    3.2.1     \n✔ lubridate 1.9.3          ✔ tidyr     1.3.1     \n✔ purrr     1.0.4          \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(\"ggResidpanel\")\nlibrary(\"emmeans\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWelcome to emmeans.\nCaution: You lose important information if you filter this package's results.\nSee '? untidy'\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(\"lme4\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: Matrix\n\nAttaching package: 'Matrix'\n\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(\"DT\")\n\noptions(width = 120)\n```\n:::\n\n\n## NFL Field Goal Kickers\n\nThis is a case study on evaluating NFL field goal kickers. \nThe data come from the 2009-2011 NFL seasons.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd <- tribble(\n  ~kicker, ~season, ~made, ~attempts,\n  \"Janikowski\", 2009, 26, 29,\n  \"Hartley\", 2009, 9, 11,\n  \"Janikowski\", 2010, 33, 41,\n  \"Hartley\", 2010, 20, 25,\n  \"Janikowski\", 2011, 31, 35\n)\n\nd |> group_by(kicker) |> \n  summarize(\n    made = sum(made),\n    attempts = sum(attempts),\n    percentage = made / attempts\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 4\n  kicker      made attempts percentage\n  <chr>      <dbl>    <dbl>      <dbl>\n1 Hartley       29       36      0.806\n2 Janikowski    90      105      0.857\n```\n\n\n:::\n:::\n\n\n### Logistic Regression (for distance)\n\nBut kickers kick from different distances. \n\n![](hartley_distance.png)\n![](janikowski_distance.png)\n\nSince we know that distance will affect the probability of making a field goal,\nwe should adjust for distance when comparing the two kickers. \n\nWe have multiple ways of comparing the two, but one of the simplest is to \nconduct a logistic regression where the response is binary of whether or not\nthe kick was made and the explanatory variables are distance, kicker, and\nthe kicker distance interaction.\nThe interaction is important because it allows the effect of distance on \nprobability of making the field goal to be different for each kicker. \n\nHere we have an interaction between a continuous variable (distance) and \na categorical/binary variable (kicker). \nWe could evaluate whether the interaction has support in the data by doing a\nstatistical test. \nIf we decide, based on that test or other expertise, that we would liek to \ninclude an interaction, \nthen this model is equivalent to running a separate logistic regression for\neach kicker. \nThus individual regression for each kicker with the sole explanatory variable\nbeing distance is reasonable. \n\nLet $Y_{i,p}$ be in indicator that kick $i$ by player $p$ was made. \nAn independent (or individual or separate) logistic regression for each \nkicker with distance as the explanatory variable would look like\n\n$$Y_{i,p} \\stackrel{ind}{\\sim} Ber(\\pi_{i,p}), \\quad\n\\mbox{logit}(\\pi_{ip}) = \\beta_{0,p} + \\beta_{1,p} d_{i,p}\n$$\nwhere $d_{i,p}$ is the distance of kick $i$ by player $p$.\n\n\nIn all of the following figures Janikowski is in black and Hartley is in red.\n\n![](independent_logistic.png)\n\nThis plot suggests that Janikowski is a better field goal kicker but his \nprobability to make field goals is highly affected by distance while Hartley's \nprobability is more consistent across the distances. \nKnowledge of these two kickers will tell you that this is not the case since\nJanikowski is a renowned long distance kicker. \n\n### Hierarchical Regression Model\n\nThe main reason the analysis suggests the opposite is true is because we do not\nhave much data on long distance kicks for Hartley. \nUsing a random (or mixed) effects model can help to borrow strength across\nNFL kickers to better estimate Hartley (and other kickers effectiveness). \nIn this case, a random slope model would add an additional assumption\nto the logistic regression model above, namely\n\n$$\\left[ \\begin{array}{c}\\beta_{0,p} \\\\ \\beta_{1,p} \\end{array}\\right] \n\\stackrel{ind}{\\sim}\nN\\left(\\left[ \\begin{array}{c}\\beta_{0} \\\\ \\beta_{1} \\end{array}\\right],\n\\left[ \\begin{array}{cc}\\sigma^2_0 & \\rho\\sigma_0\\sigma_1 \\\\ \n\\rho\\sigma_0\\sigma_1 & \\sigma^2_1\\end{array}\\right]\n\\right)\n$$\nwhere this is a bivariate normal distribution with, across all kickers, \n\n- $\\beta_0$ is the mean intercept, \n- $\\beta_1$ is the mean slope,\n- $\\sigma_0$ is the standard deviation in the intercept,\n- $\\sigma_1$ is the standard deviation in the slope, and\n- $\\rho$ is the correlation between the intercepts and slopes.\n\nThe key with this model is that all intercepts and slopes are *shrunk* back to\nthe overall mean intercept and slope across all kickers.\nThe amount that these are shrunk is inversely related to how much data there is\nto support the individual player abilities. \nThus, players with a lot of data will not be shrunk much while players with a\nlot of data will be shrunk a lot. \n\nThe following is the estimate of Hartley (red) and Janikowski (black) probability\nof making a kick as a function of distance. \n\n![](hierarchical_probit.png)\n\nThis analysis is intuitively reasonable since Janikowski appears to be the \nbetter kicker at all distances and the effect of distance being less for\nJanikowski compared to Hartley. \n\n### Missing Model\n\nThis is actually a case of missing data. \nThe data that are missing are kicks at longer distances (for both kickers). \nThere are 4th downs (and some non 4th downs) where it would make sense to try\nfor a kick, e.g. it is late in the game and the team is down by 3 or fewer \npoints. \nIn these situations, the coach makes a decision whether to have the kicker \nattempt a field goal or not. \nFrom our knowledge of the kickers, we know that Janikowski is (relatively)\noften asked to attempt long distance kicks compared to Hartley. \nThe reason Janikowski is asked to attempt these kicks and Hartley is not is\nbecause the coach believes Janikowski has a (relatively) high probability of\nmaking the kick while Hartley does not. \n\nThus, we can build an additional model for the probability of an attempt. \nIf this probability of an attempt includes the probability of making the field\ngoal, then the model can learn about the probability of making the field\ngoal by whether or not the coach asks the kicker to attempt the kick. \n\nLet $A_{j,p}$ be an indicator that player $p$ is asked to attempt a field goal\non play $j$. \nA model could be \n\n$$A_{j,p} \\stackrel{ind}{\\sim} Ber(\\theta_{j,p}), \\quad\n\\mbox{logit}(\\theta_{j,p}) = \\alpha_{0,p} + \\alpha_{1,p} \\mbox{logit}(\\pi_{j,p})\n$$\nwhere we would likely have a hierarchical model for the $\\alpha$s.\n\nIncorporating this into the analysis provides an informative missingness \nmodel. \nThe estimated probability for Janikowski (black) and Hartley (red) from this \nmodel is given below.\n\n![](informative_missing.png)",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}