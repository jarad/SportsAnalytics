{
  "hash": "df249898c19d3fdea2e8b70cda0f89d7",
  "result": {
    "engine": "knitr",
    "markdown": "# Win-Tie-Loss Models\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"MASS\")    # polr: ordinal logistic regression model\nlibrary(\"ordinal\") # clm: ordinal logistic regression model\nlibrary(\"dplyr\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:ordinal':\n\n    slice\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:MASS':\n\n    select\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(\"tidyr\")\nlibrary(\"ggplot2\"); theme_set(theme_bw())\nlibrary(\"DT\")\n```\n:::\n\n\n\n\nWhen sports allow ties, the statistical model used should accommodate the \nordinal nature of the data. Namely,\n$$ \\mbox{Win} > \\mbox{Tie} > \\mbox{Loss} $$\nWe can extend the win-loss logistic regression model to accommodate the \npossibility of a Tie. \n\n## Model\n\nTo construct an ordinal logistic regression model, \nwe will start with a latent-variable representation of the logistic regression \nmodel. \nWe will then add additional cut-points to represent the different possible \ngame outcomes. \n\n### Latent Variable Logistic Regression\n\nRecall that our win-loss logistic regression model is \n$$H_g\\stackrel{ind}{\\sim} Ber(\\pi_g) \\quad \\mbox{logit}(\\pi_g) \n= \\zeta + \\theta_{H[g]} - \\theta_{A[g]}$$\nwhere \n\n- $H_g$ is an indicator that the home team won game $g$ (0 if home team lost, 1 if home team won),\n- $\\zeta$ is the home advantage, and\n- $\\theta_t$ is the strength of team $t$.\n\nAn equivalent way to express this model introduces a \n*latent variable* $M_g^\\zeta$ with a logistic distribution.\nGiven this latent variable, the outcome is deterministic. \nNamely,\n$$H_g = \\mathrm{I}(M_g^\\zeta > 0)$$ \nLatent variables often have a real-world interpretation. \nIn this case, $M_g^\\zeta$ is related to the margin of victory. \nIf the margin of victory is greater than 0,\nthe home team wins and the home win indicator is 1, i.e. $H_g = 1$. \n\nIn the implementation of the model used below,\nwe will need a transformed version of this latent variable\n$M_g = M_g^\\zeta - \\zeta$.\nWith this transformed version we have \n\n$$H_ g = \\mathrm{I}(M_g > -\\zeta)$$\nFor logistic regression, $M_g$ has a logistic distribution. \nFor identifiability reasons, this distribution has a fixed scale parameter\nand, by convention, is often set to 1.\nThus, \n$$M_g \\stackrel{ind}{\\sim} Lo(\\mu_g, 1).$$\nThe mean of this distribution is our typical model using home advantage and\nteam strengths. \n$$\\mu_g = E[M_g] = \\theta_{H[g]} - \\theta_{A[g]}.$$\nWe can show $\\pi_g = P(M_g > -\\zeta)$ and thus the latent variable representation\nis exactly the same as the typical representation we have used previously. \nChanging $E[\\mu_g]$ changes where the logistic distribution is centered on the \nnumber line and therefore the $P(M_g > -\\zeta)$.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nh <- 0.15 # height of labels\n\ng <- ggplot(data.frame(x = c(-6, 10)),\n       aes(x = x)) +\n  stat_function(fun = dlogis, \n                xlim = c(-6, -1), geom = \"area\", fill = \"red\") +\n  stat_function(fun = dlogis) +\n  geom_vline(xintercept = -1) +\n  labs(\n    x = \"m\",\n    y = \"f(m)\",\n    title = \"M ~ Lo(0, 1)\",\n    subtitle = \"P(Loss) = P(M < -1)\"\n  ) +\n  annotate(\"label\",  6, h, label = \"Win\",  size = 8) +\n  annotate(\"label\", -4, h, label = \"Loss\", size = 8) \n\ng\n```\n\n::: {.cell-output-display}\n![](win-tie-loss_files/figure-html/logistic-win-loss-1.png){width=672}\n:::\n:::\n\n\n\n\nIn this figure, \nwe can see that the estimated home advantage can be alternatively interpreted\nas the threshold (or cutpoint) for change from a loss to a win. \nValues for $M_g$ below the threshold result in a loss while values above the\nthreshold result in a win. \n\n### Ordinal Logistic Regression\n\nTo account for ties in addition to wins and losses, \nwe can include an additional threshold to separate ties from wins.  \nModifying the above picture it may look something like this. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntw <- 3 # tie-win threshold\n\ng +\n  stat_function(fun = dlogis, \n                xlim = c(tw, 10), geom = \"area\", fill = \"blue\") +\n  geom_vline(xintercept = tw) +\n  annotate(\"label\", mean(c(-1, tw)), h, label = \"Tie\", size = 8) +\n  labs(\n    subtitle = \"P(Loss) = P(M < -1), P(Win) = P(M > 3)\"\n  )\n```\n\n::: {.cell-output-display}\n![](win-tie-loss_files/figure-html/logistic-win-tie-loss-1.png){width=672}\n:::\n:::\n\n\n\n\nSo we ordinal logistic regression model has a similar latent variable \n$$M_g \\stackrel{ind}{\\sim} Lo(\\theta_{H[g]} - \\theta_{A[g]}, 1)$$\nand two thresholds\n$$\\mbox{R}_g = \\left\\{ \\begin{array}{ll}\nLoss & M_g < \\zeta_1 \\\\\nTie  & \\zeta_1 < M_g < \\zeta_2 \\\\\nWin  & \\zeta_2 < M_g\n\\end{array} \\right.$$\n$R_g$ is an ordinal categorical variable that indicates the result of the \ngame (loss, tie, or win) from the home team's perspective.\nThe parameters in this model are \n\n- $\\theta_t$: strength of team $t$,\n- $\\zeta_1$: threshold separating loss from tie, and\n- $\\zeta_2$: threshold separating tie from win.\n\nThe thresholds are common to all games and teams. \nThe thresholds are related to home advantage since, \nas the values of these thresholds get more negative,\nthe probability the home team wins increases. \n\nTo calculate loss, tie, and win probabilities, we calculate the probability\nthat the latent variable $M_g$ falls within the three intervals: \n$(-\\infty, \\zeta_1)$, $(\\zeta_1, \\zeta_2)$, and $(\\zeta_2,\\infty)$, respectively.\n\n\n## Examples\n\n### 2024-2025 Serie A\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nserieA_raw <- read.csv(\"data/serieA_2024-2025.csv\")\n\nserieA_teams <- with(serieA_raw, sort(unique(c(Home, Away))))\n\nserieA <- serieA_raw |>\n  mutate(\n    home_result = case_when(\n      Home_Score >  Away_Score ~ \"Win\",\n      Home_Score == Away_Score ~ \"Tie\",\n      Home_Score <  Away_Score ~ \"Loss\"\n    ),\n    \n    home_result = factor(home_result,\n                         levels = c(\"Loss\", \"Tie\", \"Win\"), # order matters\n                         ordered = TRUE), # needed for ordinal regression\n    \n    Home = factor(Home, levels = serieA_teams),\n    Away = factor(Away, levels = serieA_teams)\n  )\n```\n:::\n\n\n\n\nWhen we construct the ordered factor of loss-tie-win, \nwe put it in order from loss to win.\nThis results in team strengths where\nhigher numbers indicate stronger teams. \n\nLet's check records first. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nserieA |> \n  pivot_longer(\n    cols = c(\"Home\", \"Away\"),\n    names_to = \"Location\",\n    values_to = \"Team\"\n  ) |>\n  group_by(Team) |>\n  summarize(\n    n = n(),\n    win = sum(\n      (home_result == \"Win\" & Location == \"Home\") |\n        (home_result == \"Loss\" & Location == \"Away\")\n    ),\n    tie = sum(home_result == \"Tie\"),\n    loss = n - win - tie,\n    points = 3 * win + tie\n  ) |>\n  arrange(desc(points)) |>\n  datatable(filter = \"top\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-ccfb578595e17e6842a9\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-ccfb578595e17e6842a9\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td><\\/td>\\n  <td data-type=\\\"factor\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"width: 100%; display: none;\\\">\\n      <select multiple=\\\"multiple\\\" style=\\\"width: 100%;\\\" data-options=\\\"[&quot;AC Milan&quot;,&quot;AS Roma&quot;,&quot;Atalanta&quot;,&quot;Bologna&quot;,&quot;Cagliari&quot;,&quot;Como&quot;,&quot;Empoli&quot;,&quot;Fiorentina&quot;,&quot;Genoa&quot;,&quot;Inter&quot;,&quot;Juventus&quot;,&quot;Lazio&quot;,&quot;Lecce&quot;,&quot;Monza&quot;,&quot;Napoli&quot;,&quot;Parma&quot;,&quot;Torino&quot;,&quot;Udinese&quot;,&quot;Venezia&quot;,&quot;Verona&quot;]\\\"><\\/select>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"integer\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\" disabled=\\\"\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0\\\" data-max=\\\"1\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"integer\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"2\\\" data-max=\\\"17\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"integer\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"2\\\" data-max=\\\"13\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"integer\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"1\\\" data-max=\\\"17\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"14\\\" data-max=\\\"58\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"20\"],[\"Inter\",\"Napoli\",\"Atalanta\",\"Juventus\",\"Lazio\",\"Bologna\",\"Fiorentina\",\"AS Roma\",\"AC Milan\",\"Udinese\",\"Torino\",\"Genoa\",\"Como\",\"Verona\",\"Cagliari\",\"Lecce\",\"Parma\",\"Empoli\",\"Venezia\",\"Monza\"],[27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27],[17,17,16,13,15,12,13,12,11,11,8,7,7,8,6,6,5,4,3,2],[7,6,7,13,5,11,6,7,8,6,10,10,7,2,7,7,8,10,9,8],[3,4,4,1,7,4,8,8,8,10,9,10,13,17,14,14,14,13,15,17],[58,57,55,52,50,47,45,43,41,39,34,31,28,26,25,25,23,22,18,14]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>Team<\\/th>\\n      <th>n<\\/th>\\n      <th>win<\\/th>\\n      <th>tie<\\/th>\\n      <th>loss<\\/th>\\n      <th>points<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[2,3,4,5,6]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"Team\",\"targets\":1},{\"name\":\"n\",\"targets\":2},{\"name\":\"win\",\"targets\":3},{\"name\":\"tie\",\"targets\":4},{\"name\":\"loss\",\"targets\":5},{\"name\":\"points\",\"targets\":6}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"orderCellsTop\":true}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\nIt looks like everybody has at least one win, one tie, and one loss \nso we should be able to identify the parameters. \n\nSince this is league where everybody plays everybody else and we have 27\nrounds of competitions, the graph is going to be very well connected. \n\nLet's construct out model matrix.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nconstruct_model_matrix <- function(d, homeCol = \"home\", awayCol = \"away\") {\n  n_games <- nrow(d)\n  n_teams <- length(unique(unlist(d[, homeCol], d[, awayCol])))\n  \n  m <- matrix(0, \n              nrow = n_games, \n              ncol = n_teams)\n  \n  for (g in 1:n_games) {\n    m[g, as.numeric(d[g, homeCol])] <-  1\n    m[g, as.numeric(d[g, awayCol])] <- -1\n  }\n  \n  return(m)\n}\n\nX <- construct_model_matrix(serieA, \"Home\", \"Away\")\n```\n:::\n\n\n\n\nCheck model matrix\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndim(X) # ngames x nteams\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 270  20\n```\n\n\n:::\n\n```{.r .cell-code}\ntable(X)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nX\n  -1    0    1 \n 270 4860  270 \n```\n\n\n:::\n\n```{.r .cell-code}\nall(rowSums(X) == 0)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\nall(rowSums(abs(X)) == 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\ncolSums(X)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1]  1  1 -1  1  1 -1 -1  1  1 -1  1 -1 -1  1 -1  1 -1  1 -1 -1\n```\n\n\n:::\n:::\n\n\n\n\nFit ordinal logistic regression model.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm <- polr(serieA$home_result ~ X, Hess = TRUE) # warning is expected\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in polr(serieA$home_result ~ X, Hess = TRUE): design appears to be\nrank-deficient, so dropping some coefs\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(m)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\npolr(formula = serieA$home_result ~ X, Hess = TRUE)\n\nCoefficients:\n       Value Std. Error  t value\nX1   1.18262     0.5506  2.14799\nX2   1.28796     0.5725  2.24980\nX3   2.00518     0.5764  3.47851\nX4   1.48410     0.5694  2.60664\nX5   0.30882     0.5640  0.54757\nX6   0.44888     0.5677  0.79068\nX7   0.21451     0.5617  0.38192\nX8   1.28688     0.5737  2.24306\nX9   0.58893     0.5585  1.05444\nX10  2.34810     0.5950  3.94618\nX11  1.94026     0.5582  3.47616\nX12  1.63568     0.5708  2.86565\nX13  0.11183     0.5646  0.19809\nX14 -0.51892     0.5755 -0.90162\nX15  2.47146     0.6018  4.10682\nX16  0.01012     0.5727  0.01767\nX17  0.85384     0.5543  1.54033\nX18  1.01908     0.5598  1.82046\nX19 -0.14775     0.5527 -0.26733\n\nIntercepts:\n         Value   Std. Error t value\nLoss|Tie -1.0323  0.1527    -6.7611\nTie|Win   0.5373  0.1423     3.7744\n\nResidual Deviance: 496.1578 \nAIC: 538.1578 \n```\n\n\n:::\n:::\n\n\n\n\nCompute team strengths\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nteams <- data.frame(\n  names    = serieA_teams,\n  strength = c(coef(m), 0)\n) |>\n  mutate(\n    strength = strength - mean(strength),\n    names = factor(names, levels = names[order(strength)])\n  ) |>\n  arrange(desc(names))\n\nteams |>\n  datatable(filter = \"top\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-64205c3a8a084c6660fa\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-64205c3a8a084c6660fa\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td><\\/td>\\n  <td data-type=\\\"factor\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"width: 100%; display: none;\\\">\\n      <select multiple=\\\"multiple\\\" style=\\\"width: 100%;\\\" data-options=\\\"[&quot;Monza&quot;,&quot;Venezia&quot;,&quot;Verona&quot;,&quot;Parma&quot;,&quot;Lecce&quot;,&quot;Empoli&quot;,&quot;Cagliari&quot;,&quot;Como&quot;,&quot;Genoa&quot;,&quot;Torino&quot;,&quot;Udinese&quot;,&quot;AC Milan&quot;,&quot;Fiorentina&quot;,&quot;AS Roma&quot;,&quot;Bologna&quot;,&quot;Lazio&quot;,&quot;Juventus&quot;,&quot;Atalanta&quot;,&quot;Inter&quot;,&quot;Napoli&quot;]\\\"><\\/select>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"-1.44550358898773\\\" data-max=\\\"1.54487999987187\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"data\":[[\"X15\",\"X10\",\"X3\",\"X11\",\"X12\",\"X4\",\"X2\",\"X8\",\"X1\",\"X18\",\"X17\",\"X9\",\"X6\",\"X5\",\"X7\",\"X13\",\"X16\",\"...18\",\"X19\",\"X14\"],[\"Napoli\",\"Inter\",\"Atalanta\",\"Juventus\",\"Lazio\",\"Bologna\",\"AS Roma\",\"Fiorentina\",\"AC Milan\",\"Udinese\",\"Torino\",\"Genoa\",\"Como\",\"Cagliari\",\"Empoli\",\"Lecce\",\"Parma\",\"Verona\",\"Venezia\",\"Monza\"],[1.544879999871871,1.421518603011712,1.078596778088894,1.01368478648381,0.7091052787053694,0.5575252323724692,0.3613808223962179,0.3602993381012957,0.2560396707116327,0.09250118479104119,-0.07274321836768749,-0.3376492691802222,-0.4776979106781425,-0.6177567361855734,-0.7120650677952542,-0.814747321177912,-0.9164609733164528,-0.9265789526146048,-1.074328656230737,-1.445503588987727]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>names<\\/th>\\n      <th>strength<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":2},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"names\",\"targets\":1},{\"name\":\"strength\",\"targets\":2}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"orderCellsTop\":true}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\nPlot team strengths\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(teams,\n       aes(\n         x = strength,\n         y = names\n       )) +\n  geom_bar(stat = \"identity\") +\n  labs(\n    x = 'Strength',\n    y = 'Team',\n    title = '2024-2025 Serie A',\n    subtitle = '(through round 27)'\n  )\n```\n\n::: {.cell-output-display}\n![](win-tie-loss_files/figure-html/serieA-strength-plot-1.png){width=672}\n:::\n:::\n\n\n\n\nTo calculate probabilities we need to utilize the intercepts from the \nmodel output. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm$zeta # thresholds\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Loss|Tie   Tie|Win \n-1.032252  0.537282 \n```\n\n\n:::\n:::\n\n\n\n\nThese intercepts indicate the change-points when moving from a Loss to Tie to\nWin. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function to calculate probabilities\ncalculate_ordinal_probabilities <- function(mean, zeta) {\n  p <- c(\n    plogis(zeta[1] - mean),\n    diff(plogis(zeta - mean)),\n    plogis(zeta[2] - mean, lower.tail = FALSE)\n  ) \n  \n  names(p) <- c(\"loss\", \"tie\", \"win\")\n  \n  return(p)\n}\n\n# Equal strength teams\ncalculate_ordinal_probabilities(0, m$zeta)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     loss       tie       win \n0.2626477 0.3685322 0.3688201 \n```\n\n\n:::\n:::\n\n\n\n\nWe can visualize these probabilities using the logistic distribution and the\nareas under the curve. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data.frame(x = c(-8, 8)),\n       aes(x = x)) +\n  stat_function(fun = dlogis, \n                xlim = c(-8, m$zeta[1]), \n                geom = \"area\", \n                fill = \"red\") +\n  stat_function(fun = dlogis, \n                xlim = c(m$zeta[2], 8), \n                geom = \"area\", \n                fill = \"blue\") +\n  stat_function(fun = dlogis) +\n  geom_vline(xintercept = m$zeta[1]) +\n  geom_vline(xintercept = m$zeta[2]) +\n  labs(\n    y = \"f(x)\",\n    title = \"X ~ Lo(0, 1)\"\n  ) +\n  annotate(\"text\",  m$zeta[2]+5,  0.15, label = \"Win\",  size = 8) +\n  annotate(\"text\",  m$zeta[1]-3,  0.15, label = \"Loss\", size = 8) +\n  annotate(\"text\",  mean(m$zeta), 0.15, label = \"Tie\",  size = 8) \n```\n\n::: {.cell-output-display}\n![](win-tie-loss_files/figure-html/equal-strength-probabilities-visualize-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Napoli v Inter\ncalculate_ordinal_probabilities(\n  teams$strength[teams$names == \"Napoli\"] -\n    teams$strength[teams$names == \"Inter\"], \n  m$zeta)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     loss       tie       win \n0.2394653 0.3625623 0.3979724 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Napoli v Inter\ncalculate_ordinal_probabilities(\n  teams$strength[teams$names == \"Napoli\"] -\n    teams$strength[teams$names == \"Monza\"], \n  m$zeta)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      loss        tie        win \n0.01759073 0.06162130 0.92078797 \n```\n\n\n:::\n:::\n\n\n\n\n## R packages\n\nIn this analysis, we utilized the `polr()` function from the \n[MASS package](https://cran.r-project.org/web/packages/MASS/index.html) \nsince this package is installed by default when you install R.\n\nThe [ordinal](https://cran.r-project.org/web/packages/ordinal/index.html)\ncan also implement the ordinal logistic regression model using the `clm()` \nfunction. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmo <- ordinal::clm(serieA$home_result ~ X)\nsummary(mo)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nformula: serieA$home_result ~ X\n\n link  threshold nobs logLik  AIC    niter max.grad cond.H \n logit flexible  270  -248.08 538.16 4(0)  7.57e-08 3.1e+02\n\nCoefficients: (1 not defined because of singularities)\n    Estimate Std. Error z value Pr(>|z|)    \nX1   1.18255    0.55057   2.148 0.031725 *  \nX2   1.28817    0.57249   2.250 0.024441 *  \nX3   2.00551    0.57647   3.479 0.000503 ***\nX4   1.48435    0.56937   2.607 0.009133 ** \nX5   0.30868    0.56400   0.547 0.584168    \nX6   0.44900    0.56772   0.791 0.429012    \nX7   0.21487    0.56167   0.383 0.702052    \nX8   1.28734    0.57373   2.244 0.024844 *  \nX9   0.58919    0.55853   1.055 0.291472    \nX10  2.34794    0.59503   3.946 7.95e-05 ***\nX11  1.94024    0.55817   3.476 0.000509 ***\nX12  1.63564    0.57079   2.866 0.004163 ** \nX13  0.11194    0.56457   0.198 0.842829    \nX14 -0.51932    0.57557  -0.902 0.366920    \nX15  2.47149    0.60180   4.107 4.01e-05 ***\nX16  0.01056    0.57268   0.018 0.985285    \nX17  0.85397    0.55433   1.541 0.123427    \nX18  1.01946    0.55980   1.821 0.068591 .  \nX19 -0.14806    0.55270  -0.268 0.788785    \nX20       NA         NA      NA       NA    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nThreshold coefficients:\n         Estimate Std. Error z value\nLoss|Tie  -1.0323     0.1527  -6.761\nTie|Win    0.5373     0.1423   3.774\n```\n\n\n:::\n:::\n\n\n\n\nAn appealing aspect of this package is the ability to fixed mixed effect \nordinal regression models using the `clmm()` function. \n\n## Summary\n\nThe development here used the logistic distribution due to its relationship\nwith logistic regression.\nAn alternatively commonly used approach uses the normal distribution due to \nits relationship with probit regression. ",
    "supporting": [
      "win-tie-loss_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/datatables-binding-0.33/datatables.js\"></script>\n<script src=\"site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<link href=\"site_libs/nouislider-7.0.10/jquery.nouislider.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/nouislider-7.0.10/jquery.nouislider.min.js\"></script>\n<link href=\"site_libs/selectize-0.12.0/selectize.bootstrap3.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/selectize-0.12.0/selectize.min.js\"></script>\n<link href=\"site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}